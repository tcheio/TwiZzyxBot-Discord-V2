const { PermissionsBitField, ChannelType, ActionRowBuilder, ButtonBuilder, ButtonStyle } = require('discord.js');

module.exports = (client) => {
  client.on('interactionCreate', async interaction => {
    if (!interaction.isButton()) return;

    const category = interaction.customId;

    // Cr√©ation du channel avec le nom du joueur + cat√©gorie du ticket
    const channel = await interaction.guild.channels.create({
      name: `${interaction.user.username}-${category}`,
      type: ChannelType.GuildText,
      permissionOverwrites: [
        {
          id: interaction.guild.roles.everyone,
          deny: [PermissionsBitField.Flags.ViewChannel],
        },
        {
          id: interaction.user.id,
          allow: [PermissionsBitField.Flags.ViewChannel, PermissionsBitField.Flags.SendMessages],
        },
        {
          id: '&1052524548811132938', // Remplace par l'ID de ton r√¥le
          allow: [PermissionsBitField.Flags.ViewChannel, PermissionsBitField.Flags.SendMessages],
        },
      ],
    });

    await interaction.reply({ content: `Votre ticket a √©t√© cr√©√©: ${channel}`, ephemeral: true });
  });

  // Fonction pour envoyer ou mettre √† jour le message de cr√©ation de ticket
  client.on('ready', async () => {
    const channel = client.channels.cache.get('1273580872267988992'); // Remplace par l'ID de ton channel

    const row = new ActionRowBuilder()
      .addComponents(
        new ButtonBuilder()
          .setCustomId('Report')
          .setLabel('üö® Report')
          .setStyle(ButtonStyle.Danger),
        new ButtonBuilder()
          .setCustomId('Question')
          .setLabel('‚ùì Question')
          .setStyle(ButtonStyle.Primary),
        new ButtonBuilder()
          .setCustomId('Partenariat')
          .setLabel('ü§ù Partenariat')
          .setStyle(ButtonStyle.Success),
      );

    const message = await channel.messages.fetch({ limit: 1 });
    if (message.size === 0) {
      await channel.send({
        content: 'Cr√©ation d\'un ticket\n\nS√©lectionnez l\'une des options ci-dessous pour cr√©er un ticket.',
        components: [row],
      });
    } else {
      await message.first().edit({
        content: 'Cr√©ation d\'un ticket\n\nS√©lectionnez l\'une des options ci-dessous pour cr√©er un ticket.',
        components: [row],
      });
    }
  });
};
